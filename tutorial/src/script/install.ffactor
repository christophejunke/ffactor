#!/bin/sh
#@ffactor2
#@

[ $# -eq 1 ] ||
{ echo "Usage: make"; exit 1; }

FF_D="$(readlink -f "$1")"
shift

check_install()
{
  local src="$FF_D/$1" dst="$2"
  if [ -h "$dst" ]
  then
    [ "$(readlink "$dst")" = "$src" ] && return 0
    echo "[1;31mError:[m Install destination is a different symlink"
    echo "Destination: $dst"
    echo "   Expected: -> $src"
    echo "        Got: -> $(readlink "$dst")"
    exit 1
  fi
  if [ -e "$dst" ]
  then
    if diff "$dst" "$src" >/dev/null
    then
      echo "[1;33m  RM $dst (same content)[m"
      rm "$dst"
    else
      echo "[1;31mError:[m Install destination is a different file"
      echo "Destination: $dst"
      echo "     Source: $src"
      exit 1
    fi
  fi
  echo "[34m  LN $dst[m"
  ln -s "$src" "$dst"
}

check_install bashrc ~/.bashrc
#@if bin/emacs
check_install emacs ~/.emacs
#@endif
